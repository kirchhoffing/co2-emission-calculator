"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[799],{6180:(t,e,o)=>{o.d(e,{YO:()=>_});var s=o(7499);let a=s.k5(["scope_1","scope_2","scope_3"]),i=s.k5(["stationary_combustion","mobile_combustion","process_emissions","fugitive_emissions","purchased_electricity","purchased_steam","purchased_heating","purchased_cooling","business_travel","employee_commuting","waste_generated","upstream_transportation","downstream_transportation"]),n=s.k5(["pending","completed","error"]),r=s.k5(["pdf","json","csv"]),c=s.Ik({id:s.Yj(),category:i,subcategory:s.Yj(),factor:s.ai().positive(),unit:s.Yj(),source:s.Yj(),region:s.Yj().optional(),year:s.ai().int().min(2e3).max(2030),isActive:s.zM().default(!0),description:s.Yj().optional()}),l=s.Ik({amount:s.ai().positive(),unit:s.Yj(),startDate:s.p6(),endDate:s.p6(),description:s.Yj().optional()}),u=s.Ik({scope:a,category:i,subcategory:s.Yj(),activityData:l,emissionFactorId:s.Yj().optional(),customEmissionFactor:s.ai().positive().optional(),metadata:s.g1(s.bz()).optional()}),m=s.Ik({id:s.Yj(),input:u,emissionFactor:c.optional(),calculatedEmissions:s.ai(),calculationMethod:s.Yj(),uncertaintyRange:s.Ik({min:s.ai(),max:s.ai()}).optional(),calculatedAt:s.p6(),status:n,errors:s.YO(s.Yj()).optional()});s.Ik({id:s.Yj(),title:s.Yj(),description:s.Yj().optional(),companyId:s.Yj(),reportingPeriod:s.Ik({start:s.p6(),end:s.p6()}),scope1Total:s.ai().optional(),scope2Total:s.ai().optional(),scope3Total:s.ai().optional(),totalEmissions:s.ai(),calculations:s.YO(m),format:r,generatedAt:s.p6(),metadata:s.g1(s.bz()).optional()}),s.Ik({fromUnit:s.Yj(),toUnit:s.Yj(),factor:s.ai().positive()});let p=t=>u.parse(t),d={energy:{kWh:1,MWh:1e3,GWh:1e6,GJ:277.778,MJ:.277778,BTU:293071e-9,therms:29.3001},volume:{L:1,gal:3.78541,"m\xb3":1e3,"ft\xb3":28.3168},mass:{kg:1,tonnes:1e3,lbs:.453592,short_tons:907.185,long_tons:1016.05},distance:{km:1,miles:1.60934,nautical_miles:1.852}},h={kWh:"energy",MWh:"energy",GWh:"energy",GJ:"energy",MJ:"energy",BTU:"energy",therms:"energy",L:"volume",gal:"volume","m\xb3":"volume","ft\xb3":"volume",kg:"mass",tonnes:"mass",lbs:"mass",short_tons:"mass",long_tons:"mass",km:"distance",miles:"distance",nautical_miles:"distance"};function g(t){return h[t]||null}function f(t,e){let o=g(t),s=g(e);return null!==o&&o===s}class y{loadEmissionFactors(t){t.forEach(t=>{this.emissionFactors.set(t.id,t)})}getEmissionFactor(t){return this.emissionFactors.get(t)}async calculate(t){try{let e,o,s=p(t),a=this.generateCalculationId();if(s.emissionFactorId){if(!(e=this.getEmissionFactor(s.emissionFactorId)))throw Error("Emission factor not found: ".concat(s.emissionFactorId));o=e.factor}else if(s.customEmissionFactor)o=s.customEmissionFactor;else throw Error("No emission factor provided");let i=await this.convertActivityDataUnits(s.activityData,e),n=await this.performCalculation(s,i,o);return{id:a,input:s,emissionFactor:e,calculatedEmissions:n,calculationMethod:this.getCalculationMethod(s),uncertaintyRange:this.calculateUncertaintyRange(n,e),calculatedAt:new Date,status:"completed"}}catch(e){return{id:this.generateCalculationId(),input:t,calculatedEmissions:0,calculationMethod:"error",calculatedAt:new Date,status:"error",errors:[e instanceof Error?e.message:"Unknown error occurred"]}}}async convertActivityDataUnits(t,e){if(!e)return t.amount;let o=t.unit,s=e.unit;if(o===s)return t.amount;if(!f(o,s))throw Error("Incompatible units: activity data in ".concat(o,", emission factor in ").concat(s));try{var a=t.amount;if(o===s)return a;if(!f(o,s))throw Error("Cannot convert from ".concat(o," to ").concat(s,": incompatible unit types"));let e=d[g(o)];if(!e[o]||!e[s])throw Error("Unsupported unit conversion: ".concat(o," to ").concat(s));return Number((a*e[o]/e[s]).toFixed(10))}catch(t){throw Error("Unit conversion failed: ".concat(t instanceof Error?t.message:"Unknown error"))}}async performCalculation(t,e,o){switch(t.scope){case"scope_1":return this.calculateScope1Emissions(t,e,o);case"scope_2":return this.calculateScope2Emissions(t,e,o);case"scope_3":return this.calculateScope3Emissions(t,e,o);default:throw Error("Unsupported emission scope: ".concat(t.scope))}}calculateScope1Emissions(t,e,o){let s=e*o;switch(t.category){case"stationary_combustion":return this.adjustForStationaryCombustion(s,t);case"mobile_combustion":return this.adjustForMobileCombustion(s,t);case"process_emissions":return this.adjustForProcessEmissions(s,t);case"fugitive_emissions":return this.adjustForFugitiveEmissions(s,t);default:return s}}calculateScope2Emissions(t,e,o){return this.adjustForScope2Method(e*o,t)}calculateScope3Emissions(t,e,o){let s=e*o;switch(t.category){case"business_travel":return this.adjustForBusinessTravel(s,t);case"employee_commuting":return this.adjustForEmployeeCommuting(s,t);default:return s}}adjustForStationaryCombustion(t,e){return t}adjustForMobileCombustion(t,e){return t}adjustForProcessEmissions(t,e){return t}adjustForFugitiveEmissions(t,e){return t}adjustForScope2Method(t,e){var o,s;return"market_based"===((null==(o=e.metadata)?void 0:o.calculationMethod)||"location_based")?t*(1-((null==(s=e.metadata)?void 0:s.renewablePercentage)||0)/100):t}adjustForBusinessTravel(t,e){return t}adjustForEmployeeCommuting(t,e){return t}calculateUncertaintyRange(t,e){if(e)return{min:.9*t,max:1.1*t}}getCalculationMethod(t){let e="".concat(t.scope.toUpperCase()," ").concat(t.category);return t.customEmissionFactor?"".concat(e," (custom emission factor)"):"".concat(e," (standard emission factor)")}generateCalculationId(){return"calc_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}async batchCalculate(t){let e=[];for(let o of t){let t=await this.calculate(o);e.push(t)}return e}getSummaryStatistics(t){let e=t.filter(t=>"completed"===t.status),o=t.filter(t=>"error"===t.status).length,s=e.reduce((t,e)=>{switch(t.total+=e.calculatedEmissions,e.input.scope){case"scope_1":t.scope1+=e.calculatedEmissions;break;case"scope_2":t.scope2+=e.calculatedEmissions;break;case"scope_3":t.scope3+=e.calculatedEmissions}return t},{total:0,scope1:0,scope2:0,scope3:0});return{totalEmissions:s.total,scope1Total:s.scope1,scope2Total:s.scope2,scope3Total:s.scope3,calculationCount:e.length,errorCount:o}}constructor(t=[]){this.emissionFactors=new Map,this.loadEmissionFactors(t)}}function _(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return new y(t)}}}]);